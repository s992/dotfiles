#!/bin/sh

function android-version() {
  ~/Library/Android/sdk/build-tools/25.0.1/aapt dump badging $1 | grep version
}

function ctx() {
  if [ -z "$1" ]; then
    kubectl config get-contexts
  else
    kubectl config use-context $1
  fi
}

function reload-zsh() {
  # Clear all functions and aliases first so they reload
  unhash -mf "*"
  unhash -ma "*"

  source ~/.zshrc
}

fh() {
  print -z $( ([ -n "$ZSH_NAME" ] && fc -l 1 || history) | fzf +s --tac | sed 's/ *[0-9]* *//')
}

fco() {
  local tags branches target
  tags=$(git tag | awk '{print "\x1b[31;1mtag\x1b[m\t" $1}') || return
  branches=$(
    git branch --all | grep -v HEAD |
    sed "s/.* //" | sed "s#remotes/[^/]*/##" |
    sort -u | awk '{print "\x1b[34;1mbranch\x1b[m\t" $1}'
  ) || return
  target=$(
    (echo "$tags"; echo "$branches") |
    fzf --no-hscroll --no-multi --delimiter="\t" -n 2 \
        --ansi --preview="git logs -200 $(echo {+2..} | awk '{print ".."$0}')"
  ) || return

  git checkout $(echo "$target" | awk '{print $2}')
}

fshow() {
  git log --graph --color=always \
      --format="%C(auto)%h%d %s %C(black)%C(bold)%cr" "$@" |
  fzf --ansi --no-sort --reverse --tiebreak=index --bind=ctrl-s:toggle-sort \
      --bind "ctrl-m:execute:
                (grep -o '[a-f0-9]\{7\}' | head -1 |
                xargs -I % sh -c 'git show --color=always % | less -R') << 'FZF-EOF'
                {}
FZF-EOF"
}
